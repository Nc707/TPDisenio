<!DOCTYPE html>
<!-- 1. Declaramos que este HTML usa 'layout.html' como plantilla -->
<html lang="es" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout.html}">
<head>
    <meta charset="UTF-8" />
    <!-- 2. Solo necesitamos definir el título. El CSS se carga desde el layout -->
    <title>Alta Huésped</title>
</head>
<body>

<!-- 3. Este bloque reemplaza al fragmento 'top-bar-content' del layout -->
<header class="top-bar" layout:fragment="top-bar-content">
    Premier
</header>

<!-- 4. Este bloque reemplaza al fragmento 'content' del layout -->
<main class="form-container" layout:fragment="content">
    <h1 th:text="${huesped != null} ? 'Editar Huésped' : 'Alta Huésped'">Alta Huésped</h1>

    <form class="guest-form" id="form-huesped" onsubmit="handleSubmit(event)" novalidate>
        
        <!--  input type="hidden" name="id" th:value="${huesped?.id}" /-->

        <div class="form-group">
            <label>Apellido<span class="required">*</span></label>
            <input type="text" name="apellido" required th:value="${huesped?.apellido}"/>
        </div>

        <div class="form-group">
            <label>Dirección<span class="required">*</span></label>
            <input type="text" name="calle" placeholder="CALLE" required th:value="${huesped?.direccion?.calle}"/>
        </div>

        <div class="form-group">
            <label>Fecha de Nacimiento<span class="required">*</span></label>
            <input type="date" name="fecha_nacimiento" required 
                   th:value="${huesped?.fechaNacimiento}"/>
        </div>

        <div class="form-group">
            <label>Nombre<span class="required">*</span></label>
            <input type="text" name="nombre" required th:value="${huesped?.nombres}"/> 
            </div>

        <div class="form-group">
            <label>NÚMERO<span class="required">*</span></label>
            <div class="small-inputs">
                <input type="text" name="numero" required th:value="${huesped?.direccion?.numero}"/>
                <input type="text" name="dpto" placeholder="DPTO" th:value="${huesped?.direccion?.departamento}"/>
                <input type="text" name="piso" placeholder="PISO" th:value="${huesped?.direccion?.piso}"/>
            </div>
        </div>

        <div class="form-group">
            <label>Teléfono<span class="required">*</span></label>
            <input type="tel" name="telefono" required pattern="[0-9+()\- ]{7,}" 
                   th:value="${huesped?.telefono}"
                   title="Ingrese un teléfono válido..."/>
        </div>

        <div class="form-group">
            <label>Tipo de Documento</label>
            <select name="tipo_documento">
                <option th:selected="${huesped?.tipoDocumento?.name() == 'DNI'}">DNI</option>
                <option th:selected="${huesped?.tipoDocumento?.name() == 'Pasaporte'}">Pasaporte</option>
                <option th:selected="${huesped?.tipoDocumento?.name() == 'CUIL'}">CUIL</option>
            </select>
        </div>

        <div class="form-group">
            <label>Código Postal<span class="required">*</span></label>
            <input type="text" name="codigo_postal" required th:value="${huesped?.direccion?.codigoPostal}"/>
        </div>

        <div class="form-group">
            <label>Email<span class="required">*</span></label>
            <input type="email" name="email" required th:value="${huesped?.email}"/>
        </div>

        <div class="form-group">
            <label>Número de Documento<span class="required">*</span></label>
            <input type="text" name="numeroDocumento" required pattern="^[0-9]{8}$" 
                   th:value="${huesped?.numeroDocumento}"
                   title="El DNI debe consistir en 8 dígitos numéricos."/>
        </div>

        <div class="form-group">
            <label>Localidad<span class="required">*</span></label>
            <input type="text" name="localidad" required th:value="${huesped?.direccion?.localidad}"/>
        </div>

        <div class="form-group">
            <label>Ocupación<span class="required">*</span></label>
            <input type="text" name="ocupacion" required th:value="${huesped?.ocupacion}"/>
        </div>

        <div class="form-group">
            <label>CUIT</label>
            <input type="text" name="cuit" th:value="${huesped?.cuit}"/>
        </div>

        <div class="form-group">
            <label>Provincia<span class="required">*</span></label>
            <input type="text" name="provincia" required th:value="${huesped?.direccion?.provincia}"/>
        </div>

        <div class="form-group">
            <label>Nacionalidad<span class="required">*</span></label>
            <input type="text" name="nacionalidad" required th:value="${huesped?.nacionalidad}"/>
        </div>

        <div class="form-group">
            <label>Posición frente al IVA</label>
            <select name="iva">
                <option value="">-- Seleccione --</option>
                <option value="CONSUMIDOR_FINAL" 
                        th:selected="${huesped?.categoriaFiscal?.name() == 'CONSUMIDOR_FINAL'}">Consumidor Final</option>
                <option value="MONOTRIBUTISTA" 
                        th:selected="${huesped?.categoriaFiscal?.name() == 'MONOTRIBUTISTA'}">Monotributista</option>
                <option value="RESPONSABLE_INSCRIPTO" 
                        th:selected="${huesped?.categoriaFiscal?.name() == 'RESPONSABLE_INSCRIPTO'}">Responsable Inscripto</option>
            </select>
        </div>

        <!-- Columna 2 vacía para respetar el diseño -->
        <div></div>

        <!-- Columna 3 vacía para respetar el diseño -->
        <div></div>

        <!-- Botones -->
       <div class="buttons-row">
    <button type="button" class="btn-secondary" onclick="showCancelModal()">CANCELAR</button>
    
    <button type="button" class="btn-secondary" onclick="limpiarFormulario()">BORRAR</button>
    
    <button type="submit" class="btn-primary">SIGUIENTE</button>
</div>
    </form>
</main>

<!-- 5. Este bloque reemplaza al fragmento 'modals' del layout -->
<div layout:fragment="modals">

    <!-- Modal de éxito -->
    <div id="modal-confirm" class="modal">
        <div class="modal-box">
            <header class="modal-header">
                <div class="modal-left">
                    <span class="modal-icon">i</span>
                </div>
                <div class="modal-right">
                    Premier
                </div>
            </header>

            <div class="modal-body">
                <p id="popup-text">
                    El huésped ha sido satisfactoriamente cargado al sistema.<br/>
                    ¿Desea cargar otro?
                </p>
            </div>

            <div class="modal-buttons">
                <button type="button" class="btn-secondary" onclick="handleNo()">NO</button>
                <button type="button" class="btn-primary" onclick="handleYes()">SÍ</button>
            </div>
        </div>
    </div>

    <!-- Modal de ERROR -->
    <div id="modal-error" class="modal">
        <div class="modal-box">
            <header class="modal-header">
                <div class="modal-left">
                    <span class="modal-icon">!</span>
                </div>
                <div class="modal-right">
                    Error
                </div>
            </header>

            <div class="modal-body">
                <p id="error-text">
                    Ocurrió un error al procesar la solicitud.
                </p>
            </div>

            <div class="modal-buttons">
                <button type="button" class="btn-primary" onclick="closeErrorModal()">Aceptar</button>
            </div>
        </div>
    </div>



<!-- Modal de CONFIRMACIÓN DE CANCELAR -->
<div id="modal-cancel" class="modal">
    <div class="modal-box">
        <header class="modal-header">
            <div class="modal-left">
                <span class="modal-icon">?</span>
            </div>
            <div class="modal-right">
                Confirmación
            </div>
        </header>

        <div class="modal-body">
            <p>
                ¿Desea cancelar el alta del huésped?
            </p>
        </div>

        <div class="modal-buttons">
            <!-- NO: vuelve al formulario con los datos -->
            <button type="button" class="btn-secondary" onclick="handleCancelNo()">No</button>

            <!-- SÍ: continúa con el paso 6 (acá decidís qué hacer) -->
            <button type="button" class="btn-primary" onclick="handleCancelYes()">Sí</button>
        </div>
    </div>
</div>

    <!-- Modal HUESPED DUPLICADO -->
    <div id="modal-duplicado" class="modal">
        <div class="modal-box">
            <header class="modal-header">
                <div class="modal-left">
                    <span class="modal-icon">!</span>
                </div>
                <div class="modal-right">
                    Huésped duplicado
                </div>
            </header>

            <div class="modal-body">
                <p id="duplicado-text">
                    Ya existe un huésped con ese tipo y número de documento.
                </p>
            </div>

            <div class="modal-buttons">
                <!-- ACEPTAR IGUALMENTE -->
                <button type="button" class="btn-primary" onclick="handleDuplicadoAceptar()">
                    ACEPTAR IGUALMENTE
                </button>

                <!-- CORREGIR -->
                <button type="button" class="btn-secondary" onclick="handleDuplicadoCorregir()">
                    CORREGIR
                </button>
            </div>
        </div>
    </div>

</div>
<!-- 6. Este bloque reemplaza al fragmento 'scripts' del layout -->
<script th:src="@{/huespedes/script.js}" layout:fragment="scripts"></script>

</body>
</html>