<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout.html}">
<head>
  <title>Reservar Habitaciones</title>
  <link rel="stylesheet" th:href="@{busqueda-habitacion.css}">
</head>
<body>

  <div class="top-bar" layout:fragment="top-bar-content">
    Premier
  </div>
  
  <div class="form-container" layout:fragment="content">
    <aside class="leyenda-container">
    <h2>Leyenda</h2>
		<ul class="leyenda">
	        <li><span class="status-circle status-seleccionada"></span>Seleccionada</li>
	        <li><span class="status-circle status-fuera_de_servicio"></span>Fuera de servicio</li>
	        <li><span class="status-circle status-reservada"></span>Reservadas</li>
	        <li><span class="status-circle status-ocupada"></span>Ocupada</li>
	        <li><span class="status-circle status-libre"></span>Libre</li>
	      </ul>
     </aside>
     <div class="main-content">
    <h1 th:text="${modoAccion == 'RESERVAR'} ? 'Reservar Habitaciones' : 'Ocupar HabitaciÃ³n'">
      Reservar Habitaciones
    </h1>
		
    <div class="busqueda-container">
      
      

      <form id="form-busqueda" 
      th:action="@{/habitaciones/buscar}" 
      th:object="${busquedaDTO}" 
      method="get">
        <input type="hidden" name="accion" th:value="${modoAccion}" />

        <div class="form-row">
          <div class="form-group">
            <label for="fecha-desde">Fecha desde</label>
            <input type="date" id="fecha-desde" th:field="*{fechaInicio}">
          </div>
          <div class="form-group">
            <label for="fecha-hasta">Fecha hasta</label>
            <input type="date" id="fecha-hasta" th:field="*{fechaFin}">
          </div>
          <button type="submit" class="btn-primary">BUSCAR</button>
        </div>
      </form>
    </div>

    <form id="form-seleccion" 
          th:action="${modoAccion == 'RESERVAR'} ? @{/reservas/crear-reserva} : @{/checkin/ocupar-habitacion}" 
          method="post" 
          th:if="${calendario.mapaDisponibilidad != null and not #maps.isEmpty(calendario.mapaDisponibilidad)}">

      <div class="grilla-container">
        <table class="grilla-habitaciones">
          <thead>
            <tr>
              <th rowspan="2">Fecha</th> <th th:each="entry : ${calendario.habitacionesAgrupadas}" 
                  th:colspan="${#lists.size(entry.value)}" 
                  th:text="${entry.key}">
                Doble Superior
              </th>
            </tr>
            
            <tr>
              <th:block th:each="entry : ${calendario.habitacionesAgrupadas}">
                <th th:each="hab : ${entry.value}" 
                    th:text="${hab.numeroHabitacion}">
                  101
                </th>
              </th:block>
            </tr>
          </thead>
          
          <tbody>
  <tr th:each="fecha : ${calendario.fechas}">
    
    <th th:text="${#temporals.format(fecha, 'dd/MM/yyyy')}"
        th:data-fecha="${fecha}"> 04/11/2025
    </th>
    
    <th:block th:each="entry : ${calendario.habitacionesAgrupadas}">
      <td th:each="hab : ${entry.value}"
          class="celda-interactiva"
          th:data-habitacion="${hab.numeroHabitacion}"
          th:data-fecha="${fecha}"
          th:with="estado=${calendario.mapaDisponibilidad.get(fecha).get(hab.numeroHabitacion)}">
        
        <div class="cell-content" 
             th:attr="data-estado=${estado.toString()}">

          <th:block th:if="${estado == T(edu.inbugwethrust.premier.suite.model.EstadoHabitacion).LIBRE}">
            <input type="checkbox" 
                   class="hidden-checkbox"
                   th:id="'chk_' + ${hab.numeroHabitacion} + '_' + ${fecha}"
                   name="celdasSeleccionadas"
                   th:value="${hab.numeroHabitacion} + '_' + ${fecha}" />
            
            <div class="status-circle status-libre"></div>
          </th:block>

          <th:block th:unless="${estado == T(edu.inbugwethrust.premier.suite.model.EstadoHabitacion).LIBRE}">
            <div class="status-circle" 
                 th:classappend="'status-' + ${estado.toString().toLowerCase()}">
            </div>
          </th:block>

        </div>
      </td>
    </th:block>
  </tr>
</tbody>
        </table>
      </div>
    </form> 
    <div class="botones-inferiores">
        <button type="button" class="btn-secondary" id="open-modal-btn">CANCELAR</button>
        <button type="button" class="btn-secondary" id="reset-btn">LIMPIAR</button>
        <button type="submit" class="btn-primary">SIGUIENTE</button>
      </div>
    </div>
    </div> <!--div layout:fragment="modals" th:include="~{fragments/modal-cancelar :: modal-cancelar}">
    </div -->

  <script layout:fragment="scripts" th:src="seleccion-rango.js"></script>
</body>

</body>
</html>